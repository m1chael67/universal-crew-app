<!DOCTYPE html>
<html lang="en">
<head>
<link rel="apple-touch-icon" href="logo_resized.png" />
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Your Jobs</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="container">
    <h1>Today's Jobs (2025-06-23)</h1>
    <div id="job-list">
      <p>Loading jobs from Booqable...</p>
    </div>
    <button onclick="clockOut()">Clock Out</button>
  </div>

  <script>
    const token = "10174653-b4a2-46ac-a480-0cf79cc89e57";

    fetch("https://api.booqable.com/v1/orders?filter[start_date]=2025-06-23", {
      headers: {
        "Authorization": "Token token=" + token,
        "Content-Type": "application/json",
        "Accept": "application/json"
      }
    })
    .then(response => response.json())
    .then(data => {
      const jobList = document.getElementById("job-list");
      jobList.innerHTML = "";
      const orders = data.orders || [];

      if (orders.length === 0) {
        jobList.innerHTML = "<p>No jobs scheduled for today.</p>";
        return;
      }

      orders.forEach(order => {
        const customer = order.customer || {};
        const items = order.order_items || [];
        let itemList = items.map(item => `<li>${item.quantity} x ${item.name}</li>`).join("");

        const block = document.createElement("div");
        block.className = "job-block";
        block.innerHTML = `
          <h2>üìç ${customer.name || "No Name"}</h2>
          <p>${customer.address_line_1 || ""}, ${customer.city || ""}, ${customer.state || ""}</p>
          <p>${customer.phone || ""}</p>
          <h4>üõ† Inventory:</h4>
          <ul>${itemList}</ul>
        `;
        jobList.appendChild(block);
      });
    })
    .catch(error => {
      console.error("Booqable fetch error:", error);
      document.getElementById("job-list").innerHTML = "<p>Error loading jobs.</p>";
    });

    function clockOut() {
      const name = localStorage.getItem("employee") || "Unknown";
      const now = new Date();
      const logEntry = `${name} clocked out at ${now.toLocaleTimeString()}`;

      const form = document.createElement('form');
      form.action = "https://formsubmit.co/michaellazarov12@gmail.com";
      form.method = "POST";
      form.style.display = "none";

      const msg = document.createElement('input');
      msg.type = "hidden";
      msg.name = "Clock Out";
      msg.value = logEntry;

      const disableCaptcha = document.createElement('input');
      disableCaptcha.type = "hidden";
      disableCaptcha.name = "_captcha";
      disableCaptcha.value = "false";

      const redirect = document.createElement('input');
      redirect.type = "hidden";
      redirect.name = "_next";
      redirect.value = "https://m1chael67.github.io/universal-crew-app/index.html";

      form.appendChild(msg);
      form.appendChild(disableCaptcha);
      form.appendChild(redirect);
      document.body.appendChild(form);
      form.submit(); // <-- this was likely missing
    }
  </script>
</body>
</html>
